import { NextResponse } from 'next/server';import { supabaseAdmin } from '../../../../../lib/supabase';export async function GET() {  const { data, error } = await supabaseAdmin    .from('registrations')    .select(`      id,      full_name,      nim,      class_option,      phone_number,      payment_proof_url,      status,      created_at,      updated_at,      trainings (name),      payment_methods (method_name, account_info)    `)    .order('created_at', { ascending: false });  if (error) {    console.error('Error fetching registrations for CSV:', error);    return NextResponse.json({ message: 'Failed to fetch data for CSV export' }, { status: 500 });  }  if (!data || data.length === 0) {    return NextResponse.json({ message: 'No data to export' }, { status: 404 });  }  const headers = [    'ID Pendaftaran', 'Nama Lengkap', 'NIM', 'Kelas', 'Nomor HP',    'Nama Pelatihan', 'Metode Pembayaran', 'Info Akun Pembayaran',    'URL Bukti Pembayaran', 'Status', 'Tanggal Daftar', 'Tanggal Update'  ];  const csvRows = data.map((row: any) => {    const trainingName = row.trainings?.name || '';    const paymentMethodName = row.payment_methods?.method_name || '';    const paymentAccountInfo = row.payment_methods?.account_info || '';    return [      row.id,      row.full_name,      row.nim,      row.class_option,      row.phone_number,      trainingName,      paymentMethodName,      paymentAccountInfo,      row.payment_proof_url,      row.status,      new Date(row.created_at).toLocaleString(),      new Date(row.updated_at).toLocaleString(),    ].map(field => {      const stringField = String(field);      if (stringField.includes(';') || stringField.includes('"') || stringField.includes('\u000A')) {        return `"${stringField.replace(/"/g, '""')}"`;      }      return stringField;    }).join(';');  });  const NEWLINE = '\u000A';  const csvContent = [headers.join(';'), ...csvRows].join(NEWLINE);  return new NextResponse(csvContent, {    headers: {      'Content-Type': 'text/csv; charset=utf-8',      'Content-Disposition': 'attachment; filename="registrations.csv"',    },  });}